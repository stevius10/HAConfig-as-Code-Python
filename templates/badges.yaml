badge_webfilter:
  &badge_webfilter
  entity: switch.adguard_home_schutz # sensor.adguard_home_dns_abfragen_blockiert
  name: Web-Filter
  card_mod:
    style: | 
      :host { 
        {% if states('switch.adguard_home_schutz') == 'on' %}
          --label-badge-red: var(--info-color)
        {% else %}
          --label-badge-red: var(--error-color); 
        {% endif %}
  tap_action: 
    action: call-service
    service: switch.toggle
    data:
      entity_id: switch.adguard_home_schutz

badge_backup:
  &badge_backup
  entity: sensor.v_last_backup
  name: Sicherung
  card_mod:
    style: | 
      :host { 
        {% if 'd' not in states('sensor.v_last_backup') %}
          --label-badge-red: var(--info-color)
        {% else %}
          --label-badge-red: var(--error-color); 
        {% endif %} 
  tap_action:
    action: navigate
    navigation_path: /cebe7a76_hassio_google_drive_backup/ingress

badge_air_quality:
  &badge_air_quality
  entity: sensor.luftqualitat
  name: Luft reinigen
  card_mod:
    style: | 
      :host { 
        {% if not states('sensor.luftqualitat') | regex_search('d{2}') %}
          --label-badge-red: var(--info-color)
        {% else %}
          --label-badge-red: var(--error-color); 
        {% endif %} 
  tap_action:
    action: call-service
    service: pyscript.script_air_cleaner_sleep
  double_tap_action:
    action: call-service
    service: pyscript.script_air_cleaner_clean
  hold_action:
    action: call-service
    service: pyscript.script_air_cleaner_turn_off
    
# Badges 

template_badges_general: 
  card:
    type: custom:layout-card
    layout: vertical
    cards:
    - type: 'custom:badge-card'
      badges: 
      
      - type: entity-filter
        entities: 
          - *badge_webfilter
        conditions:
        - condition: state
          state_not: "on"
          
      - type: entity-filter
        entities: 
          - *badge_backup
        state_filter:
          - operator: regex
            value: "[d]"
            
      - type: entity-filter
        entities: 
          - *badge_air_quality
        conditions:
          - operator: regex
            value: "d{2}"

      - type: custom:auto-entities
        card:
          type: entities
          title: Timer
        filter:
          include:
            - entity_id: timer.adguard*
              # options:
              #   tap_action:
              #     action: call-service
              #     service: timer.finish
              #     service_data:
              #       entity_id: this.entity_id
          exclude:
            - state: "idle"
            - state: "unavailable"
            - state: "none"
            - state: ""
        show_empty: false


      # - type: entity-filter
      #   entities: 
      #     - entity: timer.adguard_home_schutz
      #       name: Web-Filter
      #       tap_action:
      #         action: call-service
      #         service: timer.finish
      #         target: 
      #           entity_id: timer.adguard_home_schutz
      #     - entity: timer.heizdecke
      #       name: Heizdecke
      #       tap_action:
      #         action: call-service
      #         service: timer.finish
      #         target: 
      #           entity_id: timer.heizdecke
      #     - entity: timer.sofa
      #       name: Sofa
      #       tap_action:
      #         action: call-service
      #         service: timer.finish
      #         target: 
      #           entity_id: timer.sofa
      #     - entity: timer.bett
      #       name: Bett
      #       tap_action:
      #         action: call-service
      #         service: timer.finish
      #         target: 
      #           entity_id: timer.bett
      #     - entity: timer.luftreiniger
      #       name: Luftreiniger
      #       tap_action:
      #         action: call-service
      #         service: timer.finish
      #         target: 
      #           entity_id: timer.luftreiniger
      #     - entity: timer.wz_ventilator
      #       name: WZ-Ventilator
      #       tap_action:
      #         action: call-service
      #         service: timer.finish
      #         target: 
      #           entity_id: timer.wz_ventilator
      #     - entity: timer.sz_ventilator
      #       name: SZ-Ventilator
      #       tap_action:
      #         action: call-service
      #         service: timer.finish
      #         target: 
      #           entity_id: timer.sz_ventilator
      #     - entity: timer.schlafzimmer
      #       name: Schlafzimmer
      #       tap_action:
      #         action: call-service
      #         service: timer.finish
      #         target: 
      #           entity_id: timer.schlafzimmer
      #   conditions:
      #   - condition: state
      #     state_not: ["idle", "unavailable", "none", ""]

      - type: entity-filter
        entities: 
        - entity: timer.h_timer_schlafzimmer
          tap_action:
            action: call-service
            service: timer.finish
            target:
              entity_id: timer.h_timer_schlafzimmer
        - entity: timer.h_timer_luftreiniger
          name: Reiniger
          tap_action:
            action: call-service
            service: timer.finish
            target:
              entity_id: timer.h_timer_luftreiniger
        - entity: timer.h_timer_sz_ventilator
          name: Ventilator
          tap_action:
            action: call-service
            service: timer.finish
            target:
              entity_id: timer.h_timer_sz_ventilator
        - entity: sensor.qbittorrent_status
        conditions:
        - condition: state
          state_not: ["idle", "unavailable", "none", ""]

      - entity: sensor.fritz_box_7530_download_durchsatz
        name: "⇩"
      - entity: sensor.fritz_box_7530_upload_durchsatz
        name: "⇧"

      - type: entity-filter
        entities:
          - entity: media_player.wohnzimmer
          - entity: media_player.bad
          - entity: media_player.kueche
          - entity: media_player.schlafzimmer
        state_filter:
          - playing

template_badges_services: 
  card:
    type: custom:layout-card
    layout: vertical
    cards: 
    - type: 'custom:badge-card'
      state_color: false
      show_header_toggle: false
      badges:
      
      - *badge_air_quality

      - entity: sensor.none
        name: Alles aus- schalten
        tap_action:
          action: call-service
          service: pyscript.script_off
        hold_action:
          action: more-info
        double_tap_action:
          action: call-service
          service: homeassistant.turn_off
          data:
            entity_id: pyscript.script_off
            
template_badges_system: 
  card:
    type: custom:layout-card
    layout: vertical
    cards: 
    - type: 'custom:badge-card'
      state_color: false
      show_header_toggle: false
      badges:
      - *badge_webfilter
      - *badge_backup
      - entity: sensor.fritz_box_7530_gb_empfangen
        name: Erneut verbinden
        double_tap_action:
          action: call-service
          service: button.press
          data:
            entity_id: button.fritz_box_7530_neu_verbinden
          confirmation:
            text: Internetverbindung trennen und neu herstellen? 
        tap_action:
          action: more-info