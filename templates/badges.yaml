badge_webfilter:
  &badge_webfilter
  entity: switch.adguard_home_schutz # sensor.adguard_home_dns_abfragen_blockiert
  name: Web-Filter
  card_mod:
    style: | 
      :host { 
        {% if states('switch.adguard_home_schutz') == 'on' %}
          --label-badge-red: #556B2F;
        {% else %}
          --label-badge-text-color: rgba(128, 0, 0, 0.5); 
          --label-badge-red: maroon; 
        {% endif %} 
  tap_action: 
    action: call-service
    service: switch.toggle
    data:
      entity_id: switch.adguard_home_schutz

badge_backup:
  &badge_backup
  entity: sensor.v_last_backup
  name: Sicherung
  card_mod:
    style: | 
      :host { 
        {% if 'd' not in states('sensor.v_last_backup') %}
          --label-badge-red: #556B2F;
        {% else %}
          --label-badge-text-color: rgba(128, 0, 0, 0.5); 
          --label-badge-red: maroon; 
        {% endif %} 
  tap_action:
    action: navigate
    navigation_path: /cebe7a76_hassio_google_drive_backup/ingress
    
# Badges 

template_badges_general: 
  card:
    type: custom:layout-card
    layout: vertical
    cards:
    - type: 'custom:badge-card'
      badges: 
      - type: entity-filter
        entities: 
          - *badge_webfilter
        conditions:
        - condition: state
          state_not: "on"
      - type: entity-filter
        entities: 
          - *badge_backup
        state_filter:
          - operator: regex
            value: "[d]"
      - type: entity-filter
        entities: 
          - entity: timer.adguard_home_schutz
            name: Web-Filter
            tap_action:
              action: call-service
              service: timer.finish
              target: 
                entity_id: timer.adguard_home_schutz
          - entity: timer.heizdecke
            name: Heizdecke
            tap_action:
              action: call-service
              service: timer.finish
              target: 
                entity_id: timer.heizdecke
          - entity: timer.sofa
            name: Sofa
            tap_action:
              action: call-service
              service: timer.finish
              target: 
                entity_id: timer.sofa
          - entity: timer.bett
            name: Bett
            tap_action:
              action: call-service
              service: timer.finish
              target: 
                entity_id: timer.bett
          - entity: timer.luftreiniger
            name: Luftreiniger
            tap_action:
              action: call-service
              service: timer.finish
              target: 
                entity_id: timer.luftreiniger
          - entity: timer.wz_ventilator
            name: WZ-Ventilator
            tap_action:
              action: call-service
              service: timer.finish
              target: 
                entity_id: timer.wz_ventilator
          - entity: timer.sz_ventilator
            name: SZ-Ventilator
            tap_action:
              action: call-service
              service: timer.finish
              target: 
                entity_id: timer.sz_ventilator
          - entity: timer.schlafzimmer
            name: Schlafzimmer
            tap_action:
              action: call-service
              service: timer.finish
              target: 
                entity_id: timer.schlafzimmer
        conditions:
        - condition: state
          state_not: ["idle", "unavailable", "none", ""]

      - entity: sensor.fritz_box_7530_download_durchsatz
        name: "⇩"
      - entity: sensor.fritz_box_7530_upload_durchsatz
        name: "⇧"
        
      - type: entity-filter
        entities:
          - entity: media_player.wohnzimmer
          - entity: media_player.bad
          - entity: media_player.kueche
          - entity: media_player.schlafzimmer
        state_filter:
          - playing
              
      - type: entity-filter
        entities: 
        - entity: timer.h_timer_schlafzimmer
          tap_action:
            action: call-service
            service: timer.finish
            target:
              entity_id: timer.h_timer_schlafzimmer
        - entity: timer.h_timer_luftreiniger
          name: Reiniger
          tap_action:
            action: call-service
            service: timer.finish
            target:
              entity_id: timer.h_timer_luftreiniger
        - entity: timer.h_timer_sz_ventilator
          name: Ventilator
          tap_action:
            action: call-service
            service: timer.finish
            target:
              entity_id: timer.h_timer_sz_ventilator
        - entity: sensor.qbittorrent_status
        conditions:
        - condition: state
          state_not: ["idle", "unavailable", "none", ""]
            
template_badges_services: 
  card:
    type: custom:layout-card
    layout: vertical
    cards: 
    - type: 'custom:badge-card'
      state_color: false
      show_header_toggle: false
      badges:
      - entity: sensor.luftqualitat
        name: Luft reinigen
        tap_action:
          action: call-service
          service: pyscript.script_air_cleaner_sleep
        double_tap_action:
          action: call-service
          service: pyscript.script_air_cleaner_clean
        hold_action:
          action: call-service
          service: pyscript.script_air_cleaner_turn_off
        # card_mod: 
        #   style: |
        #     :host { 
        #       {% if states('sensor.luftreiniger_geschwindigkeit') == "Sleep" %}
        #         --label-badge-background-color: white;
        #       {% elif  states('sensor.luftreiniger_geschwindigkeit') | int(0) | int > 30 %}
        #         --label-badge-text-color: #556B2F;
        #       {% elif  states('sensor.luftreiniger_geschwindigkeit') | int(0) | int > 50 %}
        #         --label-badge-text-color: maroon;
        #       {% endif %}
        #       {% if states('sensor.luftreiniger_pm_25') | int(0) | int > 15 %}
        #         --label-badge-background-color: maroon;
        #       {% endif %}
        #     }
            
      - entity: sensor.none
        name: Alles aus- schalten
        style: |
          :host { 
            display: none
    
            {% if states('script.gh_luften') == "on" or
              states('climate.wz') == "on" or
              states('climate.sz') == "on" or
              states('light.wz_beleuchtung') == "on" or
              states('light.sz_beleuchtung') == "on" or
              states('switch.wz_ventilator') == "on" or
              states('switch.g_tischlampe') == "on" or
              states('light.sz_beleuchtung') == "on" or
              states('light.k_beleuchtung') == "on" or
              states('light.g_lampe') == "on" or
              states('switch.g_tischlampe') == "on" or
              states('fan.sz_ventilator') == "on" or         
              states('switch.sofa') == "on" or
              states('switch.heizdecke') == "on" or
              states('switch.bett') == "on" or
    
              states('media_player.kueche') == "playing" or
              states('media_player.bad') == "playing" or
              states('media_player.schlafzimmer') == "playing" or
              states('media_player.wohnzimmer') == "playing" %}
              
                display: block;
    
            {% endif %}
          }
        tap_action:
          action: call-service
          service: pyscript.script_off
        hold_action:
          action: more-info
        double_tap_action:
          action: call-service
          service: homeassistant.turn_off
          data:
            entity_id: pyscript.script_off
            
template_badges_system: 
  card:
    type: custom:layout-card
    layout: vertical
    cards: 
    - type: 'custom:badge-card'
      state_color: false
      show_header_toggle: false
      badges:
      - *badge_webfilter
      - *badge_backup
      - entity: sensor.fritz_box_7530_gb_empfangen
        name: Erneut verbinden
        double_tap_action:
          action: call-service
          service: button.press
          data:
            entity_id: button.fritz_box_7530_neu_verbinden
          confirmation:
            text: Internetverbindung trennen und neu herstellen? 
        tap_action:
          action: more-info